<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>grabthis | Premium Wildlife Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --onyx-black: #050505;
            --onyx-card: #0d0d0d;
            --onyx-accent: #10b981;
            --glass-border: rgba(255, 255, 255, 0.08);
            --nav-height: clamp(64px, 8vh, 80px);
            --card-radius: 28px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--onyx-black);
            color: #ffffff;
            overflow-x: hidden;
            padding-top: var(--nav-height);
            padding-bottom: 90px;
            scroll-behavior: smooth;
        }

        @media (min-width: 768px) { body { padding-bottom: 0; } }

        /* --- PREMIUM NAVIGATION --- */
        .glass-header {
            height: var(--nav-height);
            background: rgba(5, 5, 5, 0.75);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header-scrolled {
            background: rgba(5, 5, 5, 0.95);
            height: 64px;
        }

        .nav-pills-container {
            position: relative;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 100px;
            padding: 4px;
            display: flex;
            align-items: center;
            border: 1px solid var(--glass-border);
            gap: 2px;
        }

        .nav-pill {
            position: relative;
            z-index: 2;
            padding: 8px clamp(12px, 2vw, 24px);
            font-size: clamp(12px, 1.5vw, 14px);
            font-weight: 700;
            color: #94a3b8;
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
            border-radius: 100px;
        }

        .nav-pill:hover { color: #ffffff; background: rgba(255,255,255,0.05); }
        .nav-pill.active { color: #ffffff; }

        .sliding-indicator {
            position: absolute;
            height: calc(100% - 8px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 100px;
            z-index: 1;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            left: 4px;
        }

        /* --- MOBILE BOTTOM BAR --- */
        .mobile-nav {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--glass-border);
            padding: 12px clamp(16px, 5vw, 40px);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            border-radius: 24px 24px 0 0;
        }

        /* --- GIF TOGGLE --- */
        .live-mode-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .live-mode-btn.active {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--onyx-accent);
            color: var(--onyx-accent);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #475569;
            transition: all 0.3s ease;
        }

        .active .dot {
            background: var(--onyx-accent);
            box-shadow: 0 0 12px var(--onyx-accent);
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }

        /* --- DYNAMIC MASONRY GRID --- */
        .masonry-grid {
            column-gap: clamp(1rem, 2.5vw, 2rem);
            columns: 1;
            padding: clamp(1rem, 3vw, 3rem);
            max-width: 2400px;
            margin: 0 auto;
        }
        @media (min-width: 480px) { .masonry-grid { columns: 2; } }
        @media (min-width: 1024px) { .masonry-grid { columns: 3; } }
        @media (min-width: 1440px) { .masonry-grid { columns: 4; } }
        @media (min-width: 1920px) { .masonry-grid { columns: 5; } }

        .masonry-item {
            break-inside: avoid;
            margin-bottom: clamp(1rem, 2.5vw, 2rem);
            position: relative;
            border-radius: var(--card-radius);
            overflow: hidden;
            background: var(--onyx-card);
            border: 1px solid var(--glass-border);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            transform: translateZ(0);
            will-change: transform, border-color;
        }

        .masonry-item:hover {
            transform: translateY(-8px);
            border-color: rgba(16, 185, 129, 0.4);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }

        .masonry-item img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.8s cubic-bezier(0.2, 1, 0.3, 1);
        }

        .masonry-item:hover img {
            transform: scale(1.05);
        }

        .item-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.4s ease;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 1.5rem;
            z-index: 10;
        }

        .masonry-item:hover .item-overlay { opacity: 1; }

        .shimmer {
            background: linear-gradient(90deg, #0d0d0d 25%, #161616 50%, #0d0d0d 75%);
            background-size: 200% 100%;
            animation: shimmer-ani 1.5s infinite linear;
            min-height: 200px;
        }
        @keyframes shimmer-ani { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        #zen-modal, #download-modal { 
            background: rgba(0,0,0,0.96); 
            backdrop-filter: blur(40px); 
            display: none; 
            z-index: 400;
        }

        .modal-content {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        #hero-title {
            font-size: clamp(2.5rem, 10vw, 6rem);
            line-height: 1;
        }

        #fact-text {
            font-size: clamp(0.875rem, 1.5vw, 1.125rem);
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .reveal-card {
            animation: fadeInScale 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }
    </style>
</head>
<body class="antialiased">

    <!-- DESKTOP HEADER -->
    <header id="main-header" class="glass-header fixed top-0 left-0 right-0 z-[100]">
        <div class="max-w-[2400px] mx-auto h-full px-6 flex items-center justify-between">
            
            <div class="flex items-center gap-3 cursor-pointer shrink-0" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <div class="w-10 h-10 bg-emerald-500 rounded-xl flex items-center justify-center overflow-hidden border border-white/10 shadow-lg shadow-emerald-500/20 transition-transform active:scale-95">
                    <img src="https://i.pinimg.com/564x/44/7e/d0/447ed08b260f78759d6e7f8e3f43b3a3.jpg" alt="Logo" class="w-full h-full object-cover">
                </div>
                <h1 class="hidden lg:block font-black text-2xl tracking-tighter uppercase italic">grab<span class="text-emerald-500">this</span></h1>
            </div>

            <nav class="hidden md:flex nav-pills-container">
                <div id="nav-indicator" class="sliding-indicator"></div>
                <div onclick="switchAnimal('cat', this)" class="nav-pill active">Cats</div>
                <div onclick="switchAnimal('dog', this)" class="nav-pill">Dogs</div>
                <div onclick="switchAnimal('fox', this)" class="nav-pill">Foxes</div>
                <div onclick="switchAnimal('bird', this)" class="nav-pill">Birds</div>
                <div onclick="switchAnimal('wild', this)" class="nav-pill">Wildlife</div>
            </nav>

            <div class="flex items-center gap-3 md:gap-4">
                <button onclick="toggleMime()" id="gif-toggle" class="live-mode-btn hover:bg-white/10 transition-all active:scale-95">
                    <div class="dot"></div>
                    <span class="text-[10px] font-black uppercase tracking-widest hidden sm:block">Live Mode</span>
                </button>
                
                <button onclick="toggleSidebar()" class="relative w-10 h-10 flex items-center justify-center bg-white/5 rounded-xl text-emerald-500 hover:bg-emerald-500/10 transition-all active:scale-90 border border-white/5">
                    <i class="fas fa-bookmark"></i>
                    <span id="fav-count" class="absolute -top-1.5 -right-1.5 bg-emerald-500 text-[9px] text-white font-black w-4 h-4 rounded-full flex items-center justify-center border-2 border-[#050505]">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- MOBILE BOTTOM NAV -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 z-[110] mobile-nav flex justify-between items-center">
        <button onclick="switchAnimal('cat', this)" class="flex flex-col items-center gap-1.5 text-emerald-500 mobile-tab transition-transform active:scale-90">
            <i class="fas fa-cat text-xl"></i>
            <span class="text-[10px] font-bold uppercase tracking-tighter">Cats</span>
        </button>
        <button onclick="switchAnimal('dog', this)" class="flex flex-col items-center gap-1.5 text-gray-500 mobile-tab transition-transform active:scale-90">
            <i class="fas fa-dog text-xl"></i>
            <span class="text-[10px] font-bold uppercase tracking-tighter">Dogs</span>
        </button>
        <button onclick="surpriseMe()" class="w-14 h-14 bg-emerald-500 rounded-2xl flex items-center justify-center text-white -translate-y-8 shadow-2xl shadow-emerald-500/40 border-4 border-[#050505] active:scale-90 transition-transform">
            <i class="fas fa-bolt text-lg"></i>
        </button>
        <button onclick="switchAnimal('fox', this)" class="flex flex-col items-center gap-1.5 text-gray-500 mobile-tab transition-transform active:scale-90">
            <i class="fas fa-fox text-xl"></i>
            <span class="text-[10px] font-bold uppercase tracking-tighter">Foxes</span>
        </button>
        <button onclick="toggleSidebar()" class="flex flex-col items-center gap-1.5 text-gray-500 transition-transform active:scale-90">
            <i class="fas fa-folder-heart text-xl"></i>
            <span class="text-[10px] font-bold uppercase tracking-tighter">Vault</span>
        </button>
    </nav>

    <!-- HERO SECTION -->
    <main class="max-w-[2400px] mx-auto min-h-screen">
        <section class="px-6 py-16 md:py-24 text-center">
            <h2 id="hero-title" class="font-black tracking-tighter uppercase italic mb-4">grab<span class="text-emerald-500">this</span></h2>
            <p id="fact-text" class="text-gray-400 max-w-2xl mx-auto italic font-medium leading-relaxed opacity-80">Gathering cinematic insights from the wild...</p>
        </section>

        <!-- FEED -->
        <div id="image-grid" class="masonry-grid">
            <!-- Shimmer placeholders -->
        </div>

        <!-- SCROLL SENTINEL -->
        <div id="sentinel" class="py-24 flex justify-center">
            <div class="w-10 h-10 border-4 border-emerald-500/10 border-t-emerald-500 rounded-full animate-spin"></div>
        </div>
    </main>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="fixed inset-y-0 right-0 w-full sm:w-[480px] bg-neutral-950 border-l border-white/10 z-[200] translate-x-full transition-transform duration-700 ease-[cubic-bezier(0.2,1,0.3,1)] flex flex-col shadow-2xl">
        <div class="p-8 border-b border-white/5 flex justify-between items-center bg-black/50">
            <div>
                <h3 class="text-2xl font-black tracking-tighter uppercase italic">The Sanctuary</h3>
                <p class="text-[10px] text-emerald-500 font-black uppercase tracking-[0.3em]">Sync Vault</p>
            </div>
            <button onclick="toggleSidebar()" class="w-12 h-12 flex items-center justify-center bg-white/5 rounded-xl text-gray-400 hover:text-white transition-all"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div id="favorites-list" class="flex-1 overflow-y-auto p-6 grid grid-cols-2 gap-4 content-start no-scrollbar"></div>
        <div class="p-8 border-t border-white/5 bg-black/80">
            <button onclick="clearFavorites()" class="w-full py-5 rounded-2xl bg-red-500/10 text-red-500 font-bold uppercase text-[11px] tracking-widest hover:bg-red-500 hover:text-white transition-all">Destroy Data Sanctuary</button>
        </div>
    </aside>

    <!-- DETAIL MODAL -->
    <div id="zen-modal" class="fixed inset-0 p-4 flex items-center justify-center overflow-y-auto">
        <div class="absolute inset-0 bg-black/40" onclick="closeZen()"></div>
        <button onclick="closeZen()" class="absolute top-6 right-6 text-white text-3xl z-[410] hover:text-emerald-500 transition-colors w-14 h-14 bg-white/5 rounded-full flex items-center justify-center backdrop-blur-md"><i class="fas fa-times"></i></button>
        <div class="modal-content max-w-7xl w-full flex flex-col lg:flex-row gap-8 lg:gap-16 items-center bg-black/90 p-8 lg:p-12 rounded-[48px] border border-white/10 shadow-2xl relative">
            <div class="flex-1 relative w-full flex justify-center">
                <img id="zen-img" src="" class="rounded-[32px] max-h-[75vh] object-contain shadow-2xl w-full">
            </div>
            <div class="w-full lg:w-[420px] flex flex-col gap-8 shrink-0">
                <div class="bg-white/5 p-8 rounded-[32px] border border-white/5 relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-32 h-32 bg-emerald-500/10 blur-3xl rounded-full"></div>
                    <h4 class="text-emerald-500 font-black text-2xl uppercase italic tracking-tighter mb-4">Gemini Insight</h4>
                    <p id="zen-desc" class="text-gray-300 text-base leading-relaxed italic font-medium opacity-90">Analyzing biological patterns...</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="copyLink()" class="flex-1 py-5 rounded-[20px] bg-white/10 font-black text-[11px] uppercase tracking-widest hover:bg-white/20 transition-all border border-white/5 active:scale-95"><i class="fas fa-link mr-2"></i> Share</button>
                    <button id="zen-save-btn" class="flex-1 py-5 rounded-[20px] bg-emerald-500 font-black text-[11px] uppercase tracking-widest hover:bg-emerald-400 transition-all shadow-xl active:scale-95 text-white">Save Pin</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DOWNLOAD MODAL (THE FIX) -->
    <div id="download-modal" class="fixed inset-0 p-4 flex items-center justify-center z-[500]">
        <div class="absolute inset-0 bg-black/80" onclick="closeDownload()"></div>
        <div class="modal-content max-w-lg w-full bg-[#111] border border-white/10 p-8 rounded-[40px] text-center relative shadow-2xl">
            <h4 class="text-white font-black text-2xl uppercase italic tracking-tighter mb-4">Sanctuary Export</h4>
            <p class="text-gray-400 text-sm mb-8">Security protocols prevent direct export for this specific record. Please use the system save method below.</p>
            
            <div class="relative w-full aspect-square rounded-3xl overflow-hidden mb-8 border border-white/5 shadow-inner">
                <img id="download-preview" src="" class="w-full h-full object-cover">
            </div>

            <p class="text-emerald-500 font-bold text-[10px] uppercase tracking-[0.2em] mb-8">Tap & Hold (Mobile) or Right-Click (PC) to Save</p>

            <button onclick="closeDownload()" class="w-full py-5 rounded-2xl bg-white/5 text-white font-black uppercase text-[10px] tracking-widest border border-white/10 hover:bg-white/10 transition-all">Dismiss</button>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed bottom-24 md:bottom-12 left-1/2 -translate-x-1/2 bg-white text-black px-12 py-5 rounded-full font-black text-[10px] uppercase tracking-widest shadow-2xl transition-all duration-500 opacity-0 translate-y-10 z-[400] pointer-events-none">
        Record Saved
    </div>

    <script>
        const apiKey = "";
        let currentAnimal = 'cat';
        let currentMime = 'jpg,png';
        let favorites = JSON.parse(localStorage.getItem('grabthis-favs')) || [];
        let isLoading = false;
        let page = 0;
        let currentModalUrl = '';

        const grid = document.getElementById('image-grid');
        const sentinel = document.getElementById('sentinel');
        const favLabel = document.getElementById('fav-count');
        const navIndicator = document.getElementById('nav-indicator');
        const mainHeader = document.getElementById('main-header');

        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) mainHeader.classList.add('header-scrolled');
            else mainHeader.classList.remove('header-scrolled');
        });

        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !isLoading) fetchContent(true);
        }, { rootMargin: '1200px' });

        function init() {
            observer.observe(sentinel);
            updateFavCount();
            renderFavorites();
            fetchAnimalFact();
            fetchContent();
            updateIndicator(document.querySelector('.nav-pill.active'));
        }

        function updateIndicator(el) {
            if(!el) return;
            navIndicator.style.width = `${el.offsetWidth}px`;
            navIndicator.style.left = `${el.offsetLeft}px`;
        }

        async function fetchContent(append = false) {
            if (isLoading) return;
            isLoading = true;
            if (!append) {
                grid.innerHTML = Array(12).fill('<div class="masonry-item h-72 shimmer"></div>').join('');
                page = 0;
            }
            try {
                let data = [];
                const limit = 15;
                const isGif = currentMime === 'gif';
                switch(currentAnimal) {
                    case 'cat':
                        const catRes = await fetch(`https://api.thecatapi.com/v1/images/search?limit=${limit}&page=${page}&mime_types=${currentMime}`);
                        data = await catRes.json();
                        break;
                    case 'dog':
                        const dogRes = await fetch(`https://api.thedogapi.com/v1/images/search?limit=${limit}&page=${page}&mime_types=${currentMime}`);
                        data = await dogRes.json();
                        break;
                    case 'fox':
                    case 'bird':
                    case 'wild':
                        if (isGif) {
                            const fallback = await fetch(`https://api.thecatapi.com/v1/images/search?limit=${limit}&mime_types=gif`);
                            data = await fallback.json();
                        } else {
                            const term = currentAnimal === 'wild' ? 'wildlife' : currentAnimal;
                            data = Array(limit).fill(0).map((_, i) => ({
                                url: `https://loremflickr.com/800/${800 + (i*8)}/${term},nature?lock=${Math.floor(Math.random()*10000 + page*limit)}`
                            }));
                        }
                        break;
                }
                if (page === 0) grid.innerHTML = '';
                renderBatch(data);
                page++;
            } catch (err) { console.error(err); } finally { isLoading = false; }
        }

        function renderBatch(data) {
            data.forEach((item, index) => {
                const url = item.url;
                const isFav = favorites.includes(url);
                const card = document.createElement('div');
                card.className = 'masonry-item reveal-card';
                card.style.animationDelay = `${index * 0.05}s`;
                card.onclick = (e) => { if(!e.target.closest('button')) openZen(url); };
                card.innerHTML = `
                    <img src="${url}" loading="lazy" alt="Wildlife">
                    <div class="item-overlay">
                        <button onclick="toggleFavorite('${url}', event)" class="bg-emerald-500 text-white px-6 py-2.5 rounded-full text-[11px] font-black uppercase tracking-widest shadow-xl transition-transform active:scale-95">
                            ${isFav ? 'Unsave' : 'Save'}
                        </button>
                        <button onclick="downloadMedia('${url}', event)" class="w-11 h-11 bg-white rounded-2xl flex items-center justify-center text-black shadow-lg transition-transform active:scale-90">
                            <i class="fas fa-download text-base"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        async function getAiInsight(type) {
            const desc = document.getElementById('zen-desc');
            desc.textContent = "AI Analysis in progress...";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Write one short cinematic sentence about a ${type} in the wild. Luxurious words only.` }] }] })
                });
                const result = await response.json();
                desc.textContent = result.candidates?.[0]?.content?.parts?.[0]?.text || "A phantom of the untamed earth.";
            } catch (e) { desc.textContent = "Moving with ancestral grace through the untamed kingdom."; }
        }

        function openZen(url) {
            currentModalUrl = url;
            document.getElementById('zen-img').src = url;
            const modal = document.getElementById('zen-modal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            setTimeout(() => modal.classList.add('modal-active'), 10);
            const isFav = favorites.includes(url);
            const btn = document.getElementById('zen-save-btn');
            btn.innerHTML = isFav ? 'Remove Pin' : 'Save Pin';
            btn.onclick = () => { toggleFavorite(url); btn.innerHTML = favorites.includes(url) ? 'Remove Pin' : 'Save Pin'; };
            getAiInsight(currentAnimal);
        }

        function closeZen() {
            const modal = document.getElementById('zen-modal');
            modal.classList.remove('modal-active');
            setTimeout(() => { modal.style.display = 'none'; document.body.style.overflow = 'auto'; }, 400);
        }

        // --- DOWNLOAD SYSTEM FIX ---
        async function downloadMedia(url, e) { 
            if (e) e.stopPropagation(); 
            showToast("Initializing Export...");
            
            try {
                // Add unique timestamp to prevent cached CORS failures
                const fetchUrl = url + (url.includes('?') ? '&' : '?') + 'dl=' + Date.now();
                const response = await fetch(fetchUrl, { mode: 'cors' });
                
                if (!response.ok) throw new Error('CORS block');
                
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = blobUrl;
                const ext = url.split('.').pop().split(/[?#]/)[0] || 'jpg';
                a.download = `grabthis-export-${Date.now()}.${ext}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(blobUrl);
                showToast("Download Initialized");
            } catch (err) {
                // If direct download fails, DO NOT redirect. Open in-app modal instead.
                openDownloadModal(url);
            }
        }

        function openDownloadModal(url) {
            const modal = document.getElementById('download-modal');
            document.getElementById('download-preview').src = url;
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('modal-active'), 10);
            showToast("Switching to Manual Export");
        }

        function closeDownload() {
            const modal = document.getElementById('download-modal');
            modal.classList.remove('modal-active');
            setTimeout(() => { modal.style.display = 'none'; }, 400);
        }

        function switchAnimal(type, el) {
            if (currentAnimal === type) return;
            currentAnimal = type;
            document.querySelectorAll('.nav-pill, .mobile-tab').forEach(b => {
                b.classList.remove('active', 'text-emerald-500');
                if(b.classList.contains('mobile-tab')) b.classList.add('text-gray-500');
            });
            el.classList.add('active', 'text-emerald-500');
            if(el.classList.contains('nav-pill')) updateIndicator(el);
            document.getElementById('hero-title').innerHTML = `grab<span class="text-emerald-500">this</span>`;
            fetchAnimalFact();
            fetchContent(false);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function toggleMime() {
            currentMime = currentMime === 'gif' ? 'jpg,png' : 'gif';
            const btn = document.getElementById('gif-toggle');
            if(currentMime === 'gif') { btn.classList.add('active'); showToast("Live Streams Connected"); }
            else { btn.classList.remove('active'); showToast("Static Archive Connected"); }
            fetchContent(false);
        }

        function toggleFavorite(url, e) {
            if(e) e.stopPropagation();
            const index = favorites.indexOf(url);
            if (index === -1) { favorites.unshift(url); showToast("Vault Updated"); }
            else { favorites.splice(index, 1); showToast("Record Removed"); }
            localStorage.setItem('grabthis-favs', JSON.stringify(favorites));
            updateFavCount();
            renderFavorites();
        }

        function renderFavorites() {
            const list = document.getElementById('favorites-list');
            list.innerHTML = '';
            favorites.forEach(url => {
                const div = document.createElement('div');
                div.className = 'relative aspect-square rounded-2xl overflow-hidden cursor-pointer border border-white/10 group';
                div.onclick = () => openZen(url);
                div.innerHTML = `<img src="${url}" class="w-full h-full object-cover transition-transform group-hover:scale-110 duration-500">`;
                list.appendChild(div);
            });
        }

        async function fetchAnimalFact() {
            try {
                let url = currentAnimal === 'dog' ? 'https://dog-api.kinduff.com/api/facts' : 'https://meowfacts.herokuapp.com/';
                const res = await fetch(url);
                const data = await res.json();
                document.getElementById('fact-text').textContent = `"${data.data ? data.data[0] : (data.facts ? data.facts[0] : 'The wild is calling.')}"`;
            } catch (e) {}
        }

        function surpriseMe() {
            const types = ['cat', 'dog', 'fox', 'bird', 'wild'];
            const random = types[Math.floor(Math.random() * types.length)];
            const btn = Array.from(document.querySelectorAll('.nav-pill')).find(b => b.textContent.toLowerCase().includes(random.substring(0,3)));
            if(btn) switchAnimal(random, btn);
        }

        function copyLink() { 
            const t = document.createElement('input'); 
            document.body.appendChild(t); 
            t.value = currentModalUrl; 
            t.select(); 
            document.execCommand('copy'); 
            document.body.removeChild(t); 
            showToast("Link Copied"); 
        }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('translate-x-full'); }
        function updateFavCount() { favLabel.textContent = favorites.length; }
        function clearFavorites() { if(confirm("Clear Sanctuary?")) { favorites = []; localStorage.setItem('grabthis-favs', JSON.stringify(favorites)); updateFavCount(); renderFavorites(); } }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.remove('opacity-0', 'translate-y-10');
            t.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => { t.classList.add('opacity-0', 'translate-y-10'); t.classList.remove('opacity-100', 'translate-y-0'); }, 2000);
        }

        window.onload = init;
    </script>
</body>
</html>
